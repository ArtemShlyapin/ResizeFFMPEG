# ResizeFFMPEG

# Задача: 
Уменьшить разрешение входящего видеопотока с помощью библиотеки python-ffmpeg и транслировать на экран

# Реализация:
Программа реализована с помощью файлов-посредников и библиотеки OpenCV, необходимой для захвата видеопотока с веб-камеры

1) OpenCV покадрово записывает короткие видеофайлы заданного формата в папку
```c
out = cv2.VideoWriter('output_' + '{n:04d}'.format(n=j) + '.avi',codec_DVIX, 25.0, (640,480)) 
```
2) ffmpeg находит все записанные файлы и поочерёдно преобразует в новое разрешение
```c
old = ffmpeg.input('output_' + '{n:04d}'.format(n= j) + '.avi')
new = ffmpeg.output(old, 'new_' + '{n:04d}'.format(n= j) + '.avi', s = '360x240')
```
3) OpenCV вновь вступает в работу и воспроизводит последний преобразованный файл в окне stream
```c
cap = cv2.VideoCapture('new_' + '{n:04d}'.format(n = j) + '.avi')
...
cv2.imshow('stream',frame)
```

Таким образом папка заполняется промежуточными файлами, которые впоследствии могут быть пересмотрены, проанализированы или объединены

# Запуск
Программа протестирована на Ubuntu 18.04, запуск описан под эту ОС

На вашем компьютере должны быть установлены библиотеки python-ffmpeg, python-opencv и python-os


1) Все *.py файлы проекта необходимо сложить в одной директории

2) Запуск производится поочерёдно из 3х терминалов (многопоточность на данный момент не реализована)

3) Сначала запускается resizing.py и streaming.py, после чего включается recording.py


Перед вами в левом верхнем углу появится среднего размера окно записи с камеры и спустя несколько секунд окно меньшего размера, которое является воспроизведением уже преобразованной записи. Для удобства большее окно можно оттянуть на середину экрана.


Для выключения программы нужно выделить окно записи и нажать кнопку Q на клавиатуре


После окончания работы можно запустить garbage_deleter.py, который удалит все созданные видеофайлы



# Нюансы

1) Комбинация скриптов является скорее демонстрацией, чем готовым продуктом

2) ffmpeg и opencv не волнует, записан ли файл полностью, поэтому в алгоритме они преобразуют и показывают n-1 видеозапись, где n - порядковый номер сейчас записываемой

3) Перезагрузка или временное выключение recording.py никак не повлияют на работу: запись и стрим продолжится с сохранением порядка после включения. Если включить сначала запись, а потом resizing, будут преобразованы все файлы от начала записи. Streaming в свою очередь начинает с n-1, где n - порядковый номер преобразуемого сейчас.
